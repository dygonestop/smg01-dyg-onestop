<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudKitchen | Order</title>
    <style>
        :root { --primary: #7A3E1D; --accent: #F39C12; --bg: #F7F3EE; }
        body { font-family: sans-serif; background: var(--bg); padding: 10px; padding-bottom: 120px; color: #333; }
        .card { max-width: 480px; margin: auto; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .q-box { text-align: center; background: #FFF9F0; border: 2px solid var(--accent); border-radius: 20px; padding: 15px; margin-bottom: 20px; }
        .section-title { font-size: 13px; font-weight: 800; margin: 20px 0 10px; color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; }
        .mode-selector { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .option { flex: 1; min-width: 100px; padding: 12px 5px; text-align: center; border: 2px solid #eee; border-radius: 12px; cursor: pointer; font-size: 12px; font-weight: bold; transition: 0.2s; }
        .option.active { border-color: var(--accent); background: #FFF3E6; color: var(--primary); }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-family: inherit; }
        .menu-card { border: 2px solid #eee; border-radius: 15px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn-add { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        .sticky-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 20px; border-top: 1px solid #eee; text-align: center; }
        .btn-send { width: 100%; max-width: 400px; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 18px; font-weight: 900; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <div class="q-box">
        <small style="color:var(--accent); font-weight: bold;">NOMOR ANTREAN</small>
        <div id="noAntrean" style="font-size: 45px; font-weight: 900; color: var(--primary);">#0</div>
    </div>

    <div class="section-title">üë§ Nama Pelanggan</div>
    <input type="text" id="custName" placeholder="Tulis nama Anda...">

    <div class="section-title">üìç Mode Makan</div>
    <div class="mode-selector">
        <div class="option active" onclick="selectMode('DINE IN', this)">DINE IN</div>
        <div class="option" onclick="selectMode('TAKE AWAY', this)">TAKE AWAY</div>
        <div class="option" onclick="selectMode('DELIVERY', this)">DELIVERY</div>
    </div>

    <div class="section-title">üçö Pilih Varian Nasi</div>
    <div class="mode-selector">
        <div class="option active" onclick="selectNasi('Nasi Putih', 0, this)">Putih (+0)</div>
        <div class="option" onclick="selectNasi('Nasi Uduk', 0, this)">Uduk (+0)</div>
        <div class="option" onclick="selectNasi('Nasi Cabe Ijo', 2000, this)">Cabe Ijo (+2rb)</div>
        <div class="option" onclick="selectNasi('Kecombrang', 2000, this)">Kecombrang (+2rb)</div>
        <div class="option" onclick="selectNasi('Rumput Laut', 2000, this)">R. Laut (+2rb)</div>
        <div class="option" onclick="selectNasi('Margarin', 2000, this)">Margarin (+2rb)</div>
    </div>

    <div class="section-title">üå°Ô∏è Suhu Minuman</div>
    <div class="mode-selector">
        <div class="option active" onclick="selectSuhu('Dingin/Es', this)">DINGIN / ES</div>
        <div class="option" onclick="selectSuhu('Panas/Hangat', this)">PANAS</div>
    </div>

    <div class="section-title">üç¥ Pilih Menu</div>
    <div id="menu-container">
        <div class="menu-card">
            <div><b>Ayam Geprek</b><br><small>Rp 15.000</small></div>
            <button class="btn-add" onclick="addToCart('Ayam Geprek', 15000)">Tambah</button>
        </div>
        <div class="menu-card">
            <div><b>Es Teh Manis</b><br><small>Rp 5.000</small></div>
            <button class="btn-add" onclick="addToCart('Es Teh Manis', 5000)">Tambah</button>
        </div>
    </div>

    <div class="section-title">üìù Catatan Tambahan</div>
    <textarea id="orderNote" placeholder="Contoh: Sambal dipisah..."></textarea>

    <div id="summary" style="margin-top: 25px; padding: 15px; background: #fdfdfd; border: 2px dashed #eee; border-radius: 15px; display:none;">
        <div id="cart-list"></div>
        <div id="nasi-extra" style="color:var(--accent); font-weight: bold; margin-top: 5px;"></div>
        <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
        <div style="display: flex; justify-content: space-between; font-weight: 900; font-size: 18px;">
            <span>TOTAL</span>
            <span id="totalDisplay">Rp 0</span>
        </div>
    </div>
</div>

<div class="sticky-bar">
    <button class="btn-send" id="btnSubmit" onclick="submitOrder()">KONFIRMASI PESANAN</button>
</div>

<script>
    const CONFIG = {
        WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbxBnWAOvToqhPXMOta58HRoX3EHcv66l2cfpgqWqPy8pFaJy4-VU09xh_5GmCBdmr4JeQ/exec',
        TOKEN: 'dyg-access-v2'
    };

    let cart = [], mode = 'DINE IN', nasi = 'Nasi Putih', addOnNasi = 0, suhu = 'Dingin/Es';

    function selectMode(val, el) { toggleClass(el); mode = val; }
    function selectSuhu(val, el) { toggleClass(el); suhu = val; }
    
    function selectNasi(val, harga, el) { 
        toggleClass(el); 
        nasi = val; 
        addOnNasi = harga; 
        updateUI(); 
    }

    function toggleClass(el) {
        Array.from(el.parentElement.children).forEach(c => c.classList.remove('active'));
        el.classList.add('active');
    }

    function addToCart(nama, harga) {
        cart.push({nama, harga});
        updateUI();
    }

    function updateUI() {
        const summary = document.getElementById('summary');
        if (cart.length === 0) { summary.style.display = 'none'; return; }
        
        summary.style.display = 'block';
        document.getElementById('cart-list').innerHTML = cart.map(i => `<div style="display:flex; justify-content:space-between;"><span>${i.nama}</span><span>Rp ${i.harga.toLocaleString()}</span></div>`).join('');
        
        document.getElementById('nasi-extra').innerText = addOnNasi > 0 ? `+ ${nasi} (Rp ${addOnNasi.toLocaleString()})` : '';
        
        let total = cart.reduce((a, b) => a + b.harga, 0) + addOnNasi;
        document.getElementById('totalDisplay').innerText = `Rp ${total.toLocaleString()}`;
    }

    async function submitOrder() {
        const nama = document.getElementById('custName').value;
        if (!nama || cart.length === 0) return alert("Lengkapi nama dan pilih menu!");

        const btn = document.getElementById('btnSubmit');
        btn.disabled = true; btn.innerText = "Mengirim...";

        const totalFinal = cart.reduce((a, b) => a + b.harga, 0) + addOnNasi;
        const listMenu = cart.map(i => i.nama).join(', ');

        const params = new URLSearchParams({
            token: CONFIG.TOKEN,
            nama: nama,
            mode: mode,
            nasi: nasi,
            suhu: suhu,
            pesanan: listMenu,
            total: totalFinal,
            catatan: document.getElementById('orderNote').value
        });

        try {
            const r = await fetch(CONFIG.WEB_APP_URL + "?" + params.toString());
            const qNo = await r.text();
            
            const waMsg = `*PESANAN BARU - #${qNo}*\n------------------\nüë§ *Nama:* ${nama}\nüìç *Mode:* ${mode}\nüçö *Nasi:* ${nasi}\nüå°Ô∏è *Suhu:* ${suhu}\nüç¥ *Menu:* ${listMenu}\nüí∞ *Total:* Rp ${totalFinal.toLocaleString()}\nüìù *Catatan:* ${params.get('catatan') || '-'}`;
            
            window.open(`https://wa.me/628123456789?text=${encodeURIComponent(waMsg)}`);
            location.reload();
        } catch(e) { alert("Terjadi kesalahan!"); btn.disabled = false; }
    }

    async function syncQueue() {
        while(true) {
            try {
                const r = await fetch(CONFIG.WEB_APP_URL + "?waitQueue=true");
                const n = await r.text();
                document.getElementById('noAntrean').innerText = "#" + n;
            } catch(e) { await new Promise(res => setTimeout(res, 5000)); }
        }
    }
    syncQueue();
</script>
</body>
</html>