<!DOCTYPE html>
<html lang="id">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>cloudkitchen.dyg++ | Pemesanan Online</title>
Â  Â  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
Â  Â  <style>
    /* ... (CSS bagian root dan asterisk tetap sama) ... */

    /* PERBAIKAN: Pastikan kartu tersembunyi di awal dan hanya muncul setelah tombol ditekan */
    .card { 
        max-width: 480px; 
        margin: auto; 
        background: var(--surface); 
        border-radius: 28px; 
        padding: 20px; 
        box-shadow: 0 15px 35px rgba(0,0,0,.06); 
        display: none; /* Default sembunyi */
        opacity: 0; 
        transform: translateY(20px); 
        transition: 0.6s cubic-bezier(0.2, 1, 0.3, 1); 
    }
    
    .card.visible { 
        display: block; 
        opacity: 1; 
        transform: translateY(0); 
    }

    #welcome-overlay {
        position: fixed;
        inset: 0;
        background: var(--bg);
        z-index: 10002;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    /* ... (Sisa CSS Anda yang lain) ... */
</style>

<script>
    // ... (CONFIG dan Variabel Tetap Sama) ...

    // FUNGSI BARU: Inisialisasi Banner dipindah ke sini agar tidak error di awal
    function initBanner() {
        const images = BANNER_CONFIG.BANNERS;
        const track = document.getElementById('banner-track');
        if(!track) return;
        
        track.innerHTML = images.map(img => `<img src="${img}" style="min-width: 100%; height: 180px; object-fit: cover;" onerror="this.src='https://placehold.co/600x300?text=Promo+Image'">`).join('');
        
        let touchStartX = 0;
        track.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
        track.addEventListener('touchend', e => {
            let touchEndX = e.changedTouches[0].clientX;
            if (touchStartX - touchEndX > 50) nextBanner();
            if (touchStartX - touchEndX < -50) prevBanner();
        });
        
        // Timer otomatis
        setInterval(nextBanner, 5000);
    }

    let currentIdx = 0;
    function nextBanner() {
        currentIdx = (currentIdx + 1) % BANNER_CONFIG.BANNERS.length;
        updateBanner();
    }
    function updateBanner() {
        const track = document.getElementById('banner-track');
        if(track) track.style.transform = `translateX(-${currentIdx * 100}%)`;
    }

    async function startApp() {
        const btn = document.querySelector("#welcome-overlay .btn-main");
        btn.innerText = "ğŸ” Mencari Lokasi..."; 
        btn.disabled = true;

        if (!navigator.geolocation) {
            showToast("Geolokasi tidak didukung");
            return;
        }

        navigator.geolocation.getCurrentPosition(async (pos) => {
            const { latitude, longitude } = pos.coords;
            userCoords = { lat: latitude, lng: longitude };
            
            // 1. Sembunyikan Overlay & Munculkan Card
            document.getElementById('welcome-overlay').style.display = 'none';
            const mainCard = document.getElementById('main-content');
            mainCard.classList.add('visible');

            // 2. Jalankan fungsi pendukung
            initMap(latitude, longitude);
            initBanner(); // Panggil banner di sini
            await loadMenu(); 
            syncQueue();

            try {
                userDist = await calculateRouteDistanceOSRM(latitude, longitude);
            } catch (e) {
                userDist = L.latLng(latitude, longitude).distanceTo(L.latLng(CONFIG.WARUNG_LOCATION)) * 1.3; 
            }

            if (userDist > CONFIG.RADIUS_DINE_IN) {
                document.getElementById('mDine').style.display = 'none';
                changeMode('DELIVERY', document.getElementById('mDeliv'));
            }
        }, () => {
            showToast("âš ï¸ GPS Gagal. Pastikan GPS aktif.");
            btn.innerText = "MULAI SEKARANG"; 
            btn.disabled = false;
        }, { enableHighAccuracy: true });
    }
    
    // Hapus pemanggilan initBanner() di luar fungsi agar tidak menyebabkan error sebelum startApp
</script>
Â  Â  const CONFIG = {
Â  Â  Â  Â  WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbwXOWVI840Q22XNClv9nef_kxQ7zuZXLLmlM5Y7tPa5nknNos3OgM5D0r3k315xsRN4Bg/exec',
Â  Â  Â  Â  MENU_CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZGCGtu4xfKCj0zCGB2BldzF2fLjFCIOfVSXBAMeTM-3KGHfC9mZ_bhfaTnikwxd5427w4ULtotTJH/pub?gid=2132421401&single=true&output=csv',
Â  Â  Â  Â  WARUNG_LOCATION: [-7.045132799426078, 110.39216011095742],
Â  Â  Â  Â  WA_NUMBERS: { DINE_IN: '6281393048132', DELIVERY: '6289601522700' },
Â  Â  Â  Â  TOKEN: 'dyg-access-v2',
Â  Â  Â  Â  RADIUS_DINE_IN: 150
Â  Â  };

Â  Â  let menuData = [], cart = [], currentMode = 'DINE IN', isSending = false, userDist = 0, userCoords = null;

Â  Â  const VARIAN_NASI = [
Â  Â  Â  Â  { n: 'Nasi Putih', e: 0 }, { n: 'Nasi Uduk', e: 0 },
Â  Â  Â  Â  { n: 'Nasi cabeIjo', e: 2000 }, { n: 'Nasi kecombrang', e: 2000 },
Â  Â  Â  Â  { n: 'Nasi rumputLaut', e: 2000 }, { n: 'Nasi margarin', e: 2000 }
Â  Â  ];
Â  Â  const VARIAN_MIE_GORENG = [
Â  Â  Â  Â  { n: 'Original (Biasa)', e: 0 }, { n: 'Rasa Rendang', e: 0 }, { n: 'Rasa Salero Padang', e: 0 }
Â  Â  ];
Â  Â  const VARIAN_MIE_REBUS = [
Â  Â  Â  Â  { n: 'Rasa Ayam Bawang', e: 0 }, { n: 'Rasa Soto', e: 0 }
Â  Â  ];

Â  Â  const showToast = (msg) => {
Â  Â  Â  Â  const container = document.getElementById('toast-container');
Â  Â  Â  Â  const t = document.createElement('div');
Â  Â  Â  Â  t.className = 'toast'; t.innerText = msg;
Â  Â  Â  Â  container.appendChild(t);
Â  Â  Â  Â  requestAnimationFrame(() => t.classList.add('show'));
Â  Â  Â  Â  setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 400); }, 2500);
Â  Â  };

Â  Â  function calculateOngkir(m) {
Â  Â  Â  Â  const km = m / 1000;
Â  Â  Â  Â  if (km <= 2) return 3000;
Â  Â  Â  Â  if (km <= 5) return 5000;
Â  Â  Â  Â  return 6000 + (Math.ceil(km - 5) * 2000);
Â  Â  }

Â  Â  async function calculateRouteDistanceOSRM(userLat, userLng) {
Â  Â  Â  Â  const url = `https://router.project-osrm.org/route/v1/driving/${userLng},${userLat};${CONFIG.WARUNG_LOCATION[1]},${CONFIG.WARUNG_LOCATION[0]}?overview=false`;
Â  Â  Â  Â  const resp = await fetch(url);
Â  Â  Â  Â  const data = await resp.json();
Â  Â  Â  Â  if (!data.routes || !data.routes.length) throw "Route not found";
Â  Â  Â  Â  return data.routes[0].distance;Â 
Â  Â  }

Â  Â  async function startApp() {
Â  Â  Â  Â  const btn = document.querySelector("#welcome-overlay .btn-main");
Â  Â  Â  Â  btn.innerText = "ğŸ” Mencari Lokasi..."; btn.disabled = true;
Â  Â  Â  Â  if (!navigator.geolocation) return showToast("Geolokasi tidak didukung");
Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(async (pos) => {
Â  Â  Â  Â  Â  Â  const { latitude, longitude } = pos.coords;
Â  Â  Â  Â  Â  Â  userCoords = { lat: latitude, lng: longitude };
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  userDist = await calculateRouteDistanceOSRM(latitude, longitude);
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  userDist = L.latLng(latitude, longitude).distanceTo(L.latLng(CONFIG.WARUNG_LOCATION)) * 1.3;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (userDist > CONFIG.RADIUS_DINE_IN) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mDine').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  changeMode('DELIVERY', document.getElementById('mDeliv'));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  initMap(latitude, longitude);
Â  Â  Â  Â  Â  Â  document.getElementById('welcome-overlay').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('main-content').classList.add('visible');
Â  Â  Â  Â  Â  Â  await loadMenu(); syncQueue();
Â  Â  Â  Â  }, () => {
Â  Â  Â  Â  Â  Â  showToast("âš ï¸ GPS Gagal. Pastikan GPS aktif.");
Â  Â  Â  Â  Â  Â  btn.innerText = "MULAI SEKARANG"; btn.disabled = false;
Â  Â  Â  Â  }, { enableHighAccuracy: true });
Â  Â  }

Â  Â  async function loadMenu() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const resp = await fetch(CONFIG.MENU_CSV_URL);
Â  Â  Â  Â  Â  Â  const csv = await resp.text();
Â  Â  Â  Â  Â  Â  menuData = csv.split('\n').slice(1).map((row, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  const cols = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)?.map(v => v.replace(/^"|"$/g, '')) || [];
Â  Â  Â  Â  Â  Â  Â  Â  return { id: 'm'+i, kat: cols[0], nama: cols[1], harga: parseInt(cols[2]) };
Â  Â  Â  Â  Â  Â  }).filter(m => m.nama);
Â  Â  Â  Â  Â  Â  renderMenu();
Â  Â  Â  Â  } catch (e) { showToast("Gagal memuat menu."); }
Â  Â  }

Â  Â  function renderMenu() {
Â  Â  Â  Â  const container = document.getElementById('menu-container');
Â  Â  Â  Â  const categories = [...new Set(menuData.map(m => m.kat))];
Â  Â  Â  Â  container.innerHTML = categories.map(cat => `
Â  Â  Â  Â  Â  Â  <div class="cat-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="cat-header" onclick="this.nextElementSibling.classList.toggle('active')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${cat}</span><span>â–¼</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${menuData.filter(m => m.kat === cat).map(m => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nL = m.nama.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isNasi = cat.toLowerCase().includes("hemat") || (cat.toLowerCase().includes("wardoy") && nL.includes("nasi"));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isMinum = cat.toLowerCase().includes("minum") || cat.toLowerCase().includes("hemat");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isMieG = nL.includes("mie") && nL.includes("goreng") && !nL.includes("lik");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isMieR = nL.includes("mie") && nL.includes("rebus") && !nL.includes("lik");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:start;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="flex:1;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700;">${m.nama}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small style="color:var(--muted);">Rp ${m.harga.toLocaleString()}</small>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="variant-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isNasi ? `<select id="n-${m.id}" class="variant-select">${VARIAN_NASI.map(v => `<option value="${v.n}">${v.n}${v.e>0?' (+'+v.e+')':''}</option>`).join('')}</select>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isMinum ? `<select id="s-${m.id}" class="variant-select"><option value="Es">â„ï¸ Es</option><option value="Panas">ğŸ”¥ Panas</option></select>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isMieG ? `<select id="m-${m.id}" class="variant-select"><option value="" disabled selected>ğŸœ Pilih Rasa</option>${VARIAN_MIE_GORENG.map(v => `<option value="${v.n}">${v.n}</option>`).join('')}</select>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isMieR ? `<select id="m-${m.id}" class="variant-select"><option value="" disabled selected>ğŸ² Pilih Rasa</option>${VARIAN_MIE_REBUS.map(v => `<option value="${v.n}">${v.n}</option>`).join('')}</select>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="qty-control">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-qty" onclick="updateCart('${m.id}', -1)" id="min-${m.id}" disabled>âˆ’</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="qty-${m.id}" style="font-weight:800; min-width:20px; text-align:center;">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-qty" onclick="updateCart('${m.id}', 1)">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  }

Â  Â  function updateCart(id, change) {
Â  Â  Â  Â  const item = menuData.find(m => m.id === id);
Â  Â  Â  Â  const selN = document.getElementById(`n-${id}`)?.value || null;
Â  Â  Â  Â  const selS = document.getElementById(`s-${id}`)?.value || null;
Â  Â  Â  Â  const selM = document.getElementById(`m-${id}`)?.value || null;
Â  Â  Â  Â  const extra = selN ? (VARIAN_NASI.find(v => v.n === selN)?.e || 0) : 0;
Â  Â  Â  Â  if (change > 0) {
Â  Â  Â  Â  Â  Â  cart.push({ ...item, vN: selN, vS: selS, vM: selM, ex: extra });
Â  Â  Â  Â  Â  Â  showToast(`âœ… ${item.nama} +1`);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const idx = cart.map(c => c.id).lastIndexOf(id);
Â  Â  Â  Â  Â  Â  if (idx !== -1) cart.splice(idx, 1);
Â  Â  Â  Â  }
Â  Â  Â  Â  refreshUI();
Â  Â  }

Â  Â  function refreshUI() {
Â  Â  Â  Â  let sub = 0; const counts = {};
Â  Â  Â  Â  cart.forEach(c => { sub += (c.harga + (c.ex || 0)); counts[c.id] = (counts[c.id] || 0) + 1; });
Â  Â  Â  Â  menuData.forEach(m => {
Â  Â  Â  Â  Â  Â  if(document.getElementById(`qty-${m.id}`)) document.getElementById(`qty-${m.id}`).innerText = counts[m.id] || 0;
Â  Â  Â  Â  Â  Â  if(document.getElementById(`min-${m.id}`)) document.getElementById(`min-${m.id}`).disabled = (counts[m.id] || 0) === 0;
Â  Â  Â  Â  });
Â  Â  Â  Â  let ong = (currentMode === 'DELIVERY') ? calculateOngkir(userDist) : 0;
Â  Â  Â  Â  document.getElementById('delivery-fee-row').style.display = (currentMode === 'DELIVERY') ? 'flex' : 'none';
Â  Â  Â  Â  document.getElementById('ongkir-label').style.display = (currentMode === 'DELIVERY') ? 'block' : 'none';
Â  Â  Â  Â  if(currentMode === 'DELIVERY') {
Â  Â  Â  Â  Â  Â  document.getElementById('feeDisplay').innerText = "Rp " + ong.toLocaleString();
Â  Â  Â  Â  Â  Â  document.getElementById('distDisplay').innerText = (userDist/1000).toFixed(1);
Â  Â  Â  Â  }
Â  Â  Â  Â  const total = sub + ong;
Â  Â  Â  Â  document.getElementById('totalDisplay').innerText = total.toLocaleString();
Â  Â  Â  Â  document.getElementById('miniPrice').innerText = total.toLocaleString();
Â  Â  Â  Â  document.getElementById('miniInfo').style.display = sub > 0 ? 'block' : 'none';
Â  Â  Â  Â  document.getElementById('summary-section').style.display = sub > 0 ? 'block' : 'none';
Â  Â  Â  Â  document.getElementById('btnOrder').disabled = sub === 0;

Â  Â  Â  Â  const summary = {};
Â  Â  Â  Â  cart.forEach(c => {
Â  Â  Â  Â  Â  Â  let l = c.nama; let tags = [];
Â  Â  Â  Â  Â  Â  if(c.vN) tags.push(c.vN); if(c.vS) tags.push(c.vS); if(c.vM) tags.push(c.vM);
Â  Â  Â  Â  Â  Â  if(tags.length) l += ` [${tags.join(", ")}]`;
Â  Â  Â  Â  Â  Â  summary[l] = (summary[l] || 0) + 1;
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('order-list').innerHTML = Object.entries(summary).map(([n, q]) => {
Â  Â  Â  Â  Â  Â  const proto = cart.find(c => {
Â  Â  Â  Â  Â  Â  Â  Â  let cl = c.nama; let tags = [];
Â  Â  Â  Â  Â  Â  Â  Â  if(c.vN) tags.push(c.vN); if(c.vS) tags.push(c.vS); if(c.vM) tags.push(c.vM);
Â  Â  Â  Â  Â  Â  Â  Â  if(tags.length) cl += ` [${tags.join(", ")}]`;
Â  Â  Â  Â  Â  Â  Â  Â  return cl === n;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return `<div class="order-row" data-label="${n}"><div class="swipe-delete-hint">HAPUS</div><div class="order-content" ontouchstart="hTS(event)" ontouchmove="hTM(event)" ontouchend="hTE(event)"><span>${q}x ${n}</span><span>Rp ${((proto.harga + (proto.ex || 0)) * q).toLocaleString()}</span></div></div>`;
Â  Â  Â  Â  }).join('');
Â  Â  }

Â  Â  let xS = null;
Â  Â  const hTS = (e) => { xS = e.touches[0].clientX; };
Â  Â  const hTM = (e) => {
Â  Â  Â  Â  if (!xS) return;
Â  Â  Â  Â  let diff = xS - e.touches[0].clientX;
Â  Â  Â  Â  if (diff > 30) e.currentTarget.style.transform = `translateX(-80px)`;
Â  Â  Â  Â  else if (diff < -30) e.currentTarget.style.transform = `translateX(0)`;
Â  Â  };
Â  Â  const hTE = (e) => {
Â  Â  Â  Â  let diff = xS - e.changedTouches[0].clientX;
Â  Â  Â  Â  if (diff > 120) {
Â  Â  Â  Â  Â  Â  const lbl = e.currentTarget.parentElement.getAttribute('data-label');
Â  Â  Â  Â  Â  Â  e.currentTarget.style.transform = 'translateX(-100%)';
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  cart = cart.filter(c => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let cl = c.nama; let tags = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(c.vN) tags.push(c.vN); if(c.vS) tags.push(c.vS); if(c.vM) tags.push(c.vM);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(tags.length) cl += ` [${tags.join(", ")}]`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return cl !== lbl;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`ğŸ—‘ï¸ ${lbl} dihapus`); refreshUI();
Â  Â  Â  Â  Â  Â  }, 300);
Â  Â  Â  Â  } else { e.currentTarget.style.transform = `translateX(0)`; }
Â  Â  Â  Â  xS = null;
Â  Â  };

Â  Â  async function submitOrder() {
Â  Â  Â  Â  if (isSending) return;
Â  Â  Â  Â  const nI = document.getElementById('custName'); const tI = document.getElementById('tableNo'); const aI = document.getElementById('addressDetail');
Â  Â  Â  Â  const name = nI.value.trim(); const tNo = tI.value; const addr = aI.value.trim();
Â  Â  Â  Â  [nI, tI, aI].forEach(el => { if(el) el.parentElement.classList.remove('error-focus'); });
Â  Â  Â  Â  if (!name) { closeModal(); showToast("â— Nama wajib diisi"); nI.parentElement.classList.add('error-focus'); nI.focus(); return; }
Â  Â  Â  Â  if (currentMode === 'DINE IN' && !tNo) { closeModal(); showToast("â— Nomor meja wajib diisi"); tI.parentElement.classList.add('error-focus'); tI.focus(); return; }
Â  Â  Â  Â  if (currentMode === 'DELIVERY' && !addr) { closeModal(); showToast("â— Alamat wajib diisi"); aI.parentElement.classList.add('error-focus'); aI.focus(); return; }

Â  Â  Â  Â  isSending = true; const btn = document.getElementById('btnFinal');
Â  Â  Â  Â  btn.innerText = "â³ Memproses..."; btn.disabled = true;

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const summary = {};
Â  Â  Â  Â  Â  Â  cart.forEach(c => {
Â  Â  Â  Â  Â  Â  Â  Â  let l = c.nama; let tags = [];
Â  Â  Â  Â  Â  Â  Â  Â  if(c.vN) tags.push(c.vN); if(c.vS) tags.push(c.vS); if(c.vM) tags.push(c.vM);
Â  Â  Â  Â  Â  Â  Â  Â  if(tags.length) l += ` [${tags.join(", ")}]`;
Â  Â  Â  Â  Â  Â  Â  Â  summary[l] = (summary[l] || 0) + 1;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const pRows = Object.entries(summary).map(([n, q]) => {
Â  Â  Â  Â  Â  Â  Â  Â  const proto = cart.find(c => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let cl = c.nama; let tags = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(c.vN) tags.push(c.vN); if(c.vS) tags.push(c.vS); if(c.vM) tags.push(c.vM);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(tags.length) cl += ` [${tags.join(", ")}]`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return cl === n;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  return `ğŸ“¦ *${q}x* ${n} (Rp ${(proto.harga + (proto.ex || 0)).toLocaleString()})`;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  let sub = cart.reduce((a, b) => a + b.harga + (b.ex || 0), 0);
Â  Â  Â  Â  Â  Â  let ong = (currentMode === 'DELIVERY') ? calculateOngkir(userDist) : 0;
Â  Â  Â  Â  Â  Â  const total = sub + ong;
Â  Â  Â  Â  Â  Â  const params = new URLSearchParams({ token: CONFIG.TOKEN, nama: name, mode: currentMode, pesanan: pRows.join(', '), total: total, catatan: document.getElementById('orderNote').value });
Â  Â  Â  Â  Â  Â  const resp = await fetch(CONFIG.WEB_APP_URL + "?" + params.toString());
Â  Â  Â  Â  Â  Â  const qNo = await resp.text();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const wa = currentMode === 'DELIVERY' ? CONFIG.WA_NUMBERS.DELIVERY : CONFIG.WA_NUMBERS.DINE_IN;
Â  Â  Â  Â  Â  Â  const locLink = userCoords ? `https://www.google.com/maps?q=${userCoords.lat},${userCoords.lng}` : 'Tidak terdeteksi';
Â  Â  Â  Â  Â  Â  let msg = `Halo cloudkitchen.dyg++!\n\n${currentMode === 'DELIVERY' ? 'ğŸ›µ' : (currentMode === 'DINE IN' ? 'ğŸ½ï¸' : 'ğŸ›ï¸')} *${currentMode}*\nğŸ‘¤ *Nama:* ${name}\nğŸ”¢ *ANTREAN: #${qNo}*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
Â  Â  Â  Â  Â  Â  if (currentMode === 'DINE IN') msg += `ğŸª‘ *Meja:* ${tNo}\n`;
Â  Â  Â  Â  Â  Â  else if (currentMode === 'DELIVERY') msg += `ğŸ  *Alamat:* ${addr}\nğŸ“ *Lokasi:* ${locLink}\nğŸ›µ *Ongkir:* Rp ${ong.toLocaleString()}\n`;
Â  Â  Â  Â  Â  Â  msg += `\n*PESANAN:*\n${pRows.join('\n')}\n\n*CATATAN:* ${document.getElementById('orderNote').value || '-'}\n*TOTAL BAYAR: Rp ${total.toLocaleString()}*\n\nâ­ *REVIEW:* https://search.google.com/local/writereview?placeid=ChIJj4s4oMWLcC4REIr_BWkoLiI\n\nTerimakasih!`;
Â  Â  Â  Â  Â  Â  window.location.href = `https://wa.me/${wa}?text=${encodeURIComponent(msg)}`;
Â  Â  Â  Â  Â  Â  setTimeout(() => { location.reload(); }, 3000);
Â  Â  Â  Â  } catch (e) { showToast("âŒ Gagal mengirim."); isSending = false; btn.innerText = "Kirim!"; btn.disabled = false; }
Â  Â  }

Â  Â  function changeMode(m, el) {
Â  Â  Â  Â  currentMode = m; document.querySelectorAll('.mode-option').forEach(o => o.classList.remove('active')); el.classList.add('active');
Â  Â  Â  Â  document.getElementById('boxMeja').style.display = m === 'DINE IN' ? 'block' : 'none';
Â  Â  Â  Â  document.getElementById('boxAlamat').style.display = m === 'DELIVERY' ? 'block' : 'none';
Â  Â  Â  Â  refreshUI();
Â  Â  }

Â  Â  function initMap(lat, lng) {
Â  Â  Â  Â  const map = L.map('map', { zoomControl: false }).setView([lat, lng], 16);
Â  Â  Â  Â  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
Â  Â  Â  Â  L.marker([lat, lng]).addTo(map);
Â  Â  Â  Â  L.circle(CONFIG.WARUNG_LOCATION, { radius: CONFIG.RADIUS_DINE_IN, color: 'brown', fillOpacity: 0.1 }).addTo(map);
Â  Â  }

Â  Â  async function syncQueue() {
Â  Â  Â  Â  while (true) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const resp = await fetch(CONFIG.WEB_APP_URL + `?waitQueue=true&token=${CONFIG.TOKEN}`);
Â  Â  Â  Â  Â  Â  Â  Â  const num = await resp.text();
Â  Â  Â  Â  Â  Â  Â  Â  if (num) document.getElementById('noAntrean').innerText = "#" + num;
Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(r => setTimeout(r, 10000));
Â  Â  Â  Â  Â  Â  } catch(e) { await new Promise(r => setTimeout(r, 5000)); }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function openModal() { document.getElementById('modalConfirm').style.display = 'flex'; }
Â  Â  function closeModal() { document.getElementById('modalConfirm').style.display = 'none'; }
Â  Â  function filterMenu() {
Â  Â  Â  Â  const k = document.getElementById('searchMenu').value.toLowerCase();
Â  Â  Â  Â  document.querySelectorAll('.cat-container').forEach(cat => {
Â  Â  Â  Â  Â  Â  let hasMatch = false;
Â  Â  Â  Â  Â  Â  cat.querySelectorAll('.menu-item').forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const iN = item.querySelector('div[style*="font-weight:700"]').innerText.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  if (iN.includes(k)) { item.style.display = 'block'; hasMatch = true; } else { item.style.display = 'none'; }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  cat.style.display = (k.length > 0 && !hasMatch) ? 'none' : 'block';
Â  Â  Â  Â  Â  Â  if(k.length > 0 && hasMatch) cat.querySelector('.menu-list').classList.add('active');
Â  Â  Â  Â  });
Â  Â  }
// CONFIGURASI BANNER (Ganti FOLDER_ID dengan ID folder Google Drive Anda)
const BANNER_CONFIG = {
    BANNERS: [
        'https://drive.google.com/uc?export=download&id=1VlelqeRr6IJkjpNukvPVGRmU-dog5a6H',
        'https://drive.google.com/uc?export=download&id=1QUCZW5FKKrMbwb5wwtFH1rLC-yxvbFRq',
        'https://drive.google.com/uc?export=download&id=1Vx7HFR2hv8_K4h2t8kSkUDxyb9mFVoSf'
'https://drive.google.com/uc?export=download&id=1DSSjIJrg-G_d4LozAt60EMtzRnf6RfYx'
    ]
};
let currentIdx = 0;
const track = document.getElementById('banner-track');

function initBanner() {
    const images = BANNER_CONFIG.BANNERS;
    const track = document.getElementById('banner-track');
    
    track.innerHTML = images.map(img => `
        <img src="${img}" 
             style="min-width: 100%; height: 180px; object-fit: cover;" 
             onerror="this.src='https://placehold.co/600x300?text=Gambar+Promo+Gagal+Dimuat'">
    `).join(''); 
Â  Â  // Logika Swipe Sederhana
Â  Â  let touchStartX = 0;
Â  Â  track.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
Â  Â  track.addEventListener('touchend', e => {
Â  Â  Â  Â  let touchEndX = e.changedTouches[0].clientX;
Â  Â  Â  Â  if (touchStartX - touchEndX > 50) nextBanner();
Â  Â  Â  Â  if (touchStartX - touchEndX < -50) prevBanner();
Â  Â  });
setInterval(nextBanner, 5000); // Geser tiap 5 detik
}

function nextBanner() {
Â  Â  currentIdx = (currentIdx + 1) % BANNER_CONFIG.BANNERS.length;
Â  Â  updateBanner();
}
function prevBanner() {
Â  Â  currentIdx = (currentIdx - 1 + BANNER_CONFIG.BANNERS.length) % BANNER_CONFIG.BANNERS.length;
Â  Â  updateBanner();
}
function updateBanner() {
Â  Â  track.style.transform = `translateX(-${currentIdx * 100}%)`;
}

// Panggil fungsi ini di dalam startApp()
initBanner();
</script>
</body>
</html>
